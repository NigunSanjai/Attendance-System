<div class="main">
  <nav class="nav">
    <div class="sec1">
      <span class="title">Attendance Management ({{ username }})</span>
    </div>
    <div class="sec2">
      <img [src]="url" alt="" (click)="toggleLogout()" />
    </div>
  </nav>
  <button *ngIf="showLogout" class="logout" (click)="logout()">LogOut</button>
  <div class="mainflex">
    <div class="sidenav">
      <div class="sn" (click)="toggleDash()">
        <p>Dashboard</p>
      </div>
      <div class="sn" (click)="toggleae()"><p>Add/Edit Profile</p></div>
      <div class="sn"><p>Dashboard</p></div>
    </div>
    <div class="main-section">
      <div class="dashboard" *ngIf="showDash">
        <p
          style="
            text-align: center;
            justify-self: center;
            font-style: Roboto;
            font-size: 20px;
            font-weight: 500;
            margin-left: 50px;
            margin-top: 20px;
            color: whitesmoke;
          "
        >
          Attendance for Today {{ formattedDate }}
        </p>

        <div
          class="fields"
          style="
            display: flex;
            justify-content: space-around;
            align-items: center;
          "
        >
          <mat-form-field style="margin-top: 15px">
            <input
              matInput
              [matDatepicker]="picker"
              [min]="minDate"
              [max]="maxDate"
              placeholder="Choose a date"
              (dateChange)="onDateSelected($event)"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <button mat-raised-button color="primary" (click)="getattendance()">
            Submit
          </button>
        </div>
        <div
          style="display: flex; justify-content: center; gap: 2rem"
          *ngIf="showTable"
        >
          <mat-form-field>
            <input
              matInput
              (keyup)="Filterchange($event)"
              placeholder="Enter the text"
            />
          </mat-form-field>
          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 1rem;
              color: whitesmoke;
              font-weight: 400;
            "
          >
            <div>
              <p>Total Number of Students : {{ attendance_data[0].total }}</p>
            </div>
            <div style="display: flex; gap: 1rem">
              <p>Present - FN: {{ attendance_data[0].fnp }}</p>
              <p>Absent - FN: {{ attendance_data[0].fna }}</p>
              <p>On Duty: - FN:{{ attendance_data[0].fond }}</p>
            </div>
            <div style="display: flex; gap: 1rem">
              <p>Present - AN: {{ attendance_data[0].anp }}</p>
              <p>Absent - AN: {{ attendance_data[0].ana }}</p>
              <p>On Duty: - AN:{{ attendance_data[0].aond }}</p>
            </div>
          </div>
        </div>
        <div
          *ngIf="showTable"
          style="width: 100%; height: 100%; overflow: auto"
        >
          <mat-table #table [dataSource]="dataSource" matSort>
            <ng-container matColumnDef="Name of the Student">
              <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.name }}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="Register Number">
              <mat-header-cell *matHeaderCellDef>Reg No</mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.reg_no }}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="Forenoon">
              <mat-header-cell *matHeaderCellDef>
                <mat-checkbox (change)="masterToggle('forenoon', $event)">
                  Forenoon
                </mat-checkbox>
              </mat-header-cell>
              <mat-cell *matCellDef="let row" flex>
                <mat-checkbox
                  (click)="$event.stopPropagation()"
                  (change)="checkboxChanged('forenoon', row, $event)"
                  [checked]="row.forenoon"
                >
                  {{ row.forenoon ? "Present" : "Absent" }}
                </mat-checkbox>
                <ng-container>
                  <mat-checkbox
                    (click)="$event.stopPropagation()"
                    (change)="checkboxChanged('onduty_forenoon', row, $event)"
                    [checked]="row.onduty_forenoon"
                  >
                    On Duty
                  </mat-checkbox>
                </ng-container>
              </mat-cell>
            </ng-container>

            <ng-container matColumnDef="Afternoon">
              <mat-header-cell *matHeaderCellDef>
                <mat-checkbox
                  (click)="$event.stopPropagation()"
                  (change)="masterToggle('afternoon', $event)"
                >
                  Afternoon
                </mat-checkbox>
              </mat-header-cell>
              <mat-cell *matCellDef="let row" flex>
                <mat-checkbox
                  (click)="$event.stopPropagation()"
                  (change)="checkboxChanged('afternoon', row, $event)"
                  [checked]="row.afternoon"
                >
                  {{ row.afternoon ? "Present" : "Absent" }}
                </mat-checkbox>
                <ng-container>
                  <mat-checkbox
                    (click)="$event.stopPropagation()"
                    (change)="checkboxChanged('onduty_afternoon', row, $event)"
                    [checked]="row.onduty_afternoon"
                  >
                    On Duty
                  </mat-checkbox>
                </ng-container>
              </mat-cell>
            </ng-container>

            <mat-header-row
              *matHeaderRowDef="displayedColumns"
            ></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
          </mat-table>
        </div>

        <mat-paginator
          *ngIf="showTable"
          [pageSizeOptions]="[5, 10, 20, 40, 60]"
          showFirstLastButtons
        ></mat-paginator>
      </div>
      <div class="add-edit" *ngIf="showae"><p>Add</p></div>
    </div>
  </div>
</div>
